<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>공항철도 AREX 마스터 v2.6</title>
    <style>
        :root {
            --panel-bg: #2c3e50;
            --screen-bg: #0b131a;
            --accent-blue: #0097da;
            --led-green: #2ecc71;
            --led-red: #e74c3c;
            --warning-orange: #f39c12;
            --text-color: #ecf0f1;
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; 
            height: 100dvh; 
            background-color: #1a1a1a;
            font-family: 'Pretendard', -apple-system, sans-serif;
            color: var(--text-color);
            overflow: hidden; 
            user-select: none;
            -webkit-touch-callout: none;
        }

        .cab-container {
            display: grid;
            grid-template-rows: 45px 1fr 110px; 
            height: 100dvh;
            gap: 8px;
            padding: 8px;
            box-sizing: border-box;
        }

        .top-bar {
            background: #333;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            border: 1px solid #555;
            font-size: 0.9rem;
        }

        .station-display {
            background: #000;
            padding: 4px 15px;
            border: 1px solid var(--accent-blue);
            border-radius: 5px;
            color: var(--led-green);
            font-weight: bold;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1.6fr 1fr;
            gap: 10px;
            min-height: 0; 
        }

        .lever-area {
            background: var(--panel-bg);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            justify-content: space-between;
            border: 1px solid #444;
        }

        .lever-container {
            position: relative;
            flex: 1;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px 0;
        }

        input[type=range].vertical-lever {
            appearance: none;
            width: 160px; 
            height: 35px;
            background: #111;
            transform: rotate(-90deg);
            border-radius: 20px;
            border: 3px solid #555;
            outline: none;
        }

        input[type=range].vertical-lever::-webkit-slider-thumb {
            appearance: none;
            width: 45px; height: 45px;
            background: #bdc3c7;
            border-radius: 5px;
            cursor: pointer;
            border: 2px solid #7f8c8d;
        }

        .lever-val {
            font-size: 1.3rem;
            font-weight: bold;
            padding: 3px 12px;
            background: #000;
            border-radius: 5px;
            min-width: 50px;
            text-align: center;
        }

        .center-display {
            display: grid;
            grid-template-rows: 1fr 80px 1fr; 
            gap: 8px;
            min-height: 0;
        }

        .gauge-panel {
            background: #000;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 2px solid #333;
        }

        .speed-digit {
            font-size: 3.5rem;
            font-family: 'Courier New', monospace;
            color: var(--led-green);
            line-height: 1;
        }

        .train-occupancy-board {
            background: #151e27;
            border-radius: 8px;
            border: 2px solid #444;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 4px;
        }

        .car-unit {
            flex: 1;
            margin: 0 2px;
            background: #2c3e50;
            border: 1px solid #555;
            border-radius: 3px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2px 0;
        }

        .car-label { font-size: 0.6rem; margin-bottom: 2px; }
        
        .occupancy-bar-bg {
            width: 70%; height: 20px;
            background: #111;
            position: relative; overflow: hidden;
        }

        .car-door-indicator {
            width: 100%; height: 3px; margin-top: 2px;
            background: var(--led-green);
        }

        .tcms-panel {
            background: var(--screen-bg);
            border-radius: 8px;
            padding: 6px;
            display: flex;
            flex-direction: column;
            border: 1px solid #444;
            font-size: 0.75rem;
        }

        .tcms-screen { flex: 1; padding: 2px; line-height: 1.3; }

        .tcms-btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; }
        .tcms-btn { background: #34495e; color: white; border: none; padding: 6px; border-radius: 3px; font-size: 0.7rem; }
        .tcms-btn.active { background: var(--accent-blue); }

        .bottom-panel {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 10px;
        }

        .radio-box { 
            background: #1e1e1e; border: 2px solid #444; border-radius: 8px; 
            display: flex; align-items: center; padding: 8px; gap: 8px;
        }
        .ptt-btn { width: 45px; height: 100%; background: #c0392b; border-radius: 5px; flex-shrink: 0; }
        .ann-grid { 
            background: #2c3e50; border-radius: 8px; 
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 8px;
        }

        .ann-btn { background: #34495e; color: white; border: 1px solid #555; border-radius: 5px; font-size: 0.8rem; }
        .rect-btn { width: 100%; padding: 10px 0; border: none; border-radius: 5px; font-weight: bold; color: white; font-size: 0.85rem; }
        .rect-btn:disabled { opacity: 0.2; }

        @keyframes blink { 50% { opacity: 0; } }
        .car-door-indicator.open { background: var(--led-red); animation: blink 0.5s infinite; }
    </style>
</head>
<body>

<div class="cab-container">
    <header class="top-bar">
        <select id="routeSelect" onchange="initRoute()" style="font-size: 0.8rem;">
            <option value="toIncheon">인천공항2터미널 행</option>
            <option value="toSeoul">서울역 행</option>
        </select>
        <div class="station-display">
            NEXT: <span id="nextStation">서울역</span>
        </div>
        <div id="clock" style="font-family: monospace;">00:00:00</div>
    </header>

    <main class="main-content">
        <section class="lever-area">
            <div style="font-weight:bold; color:var(--led-green); font-size:0.8rem;">주간제어기(P)</div>
            <div class="lever-container">
                <input type="range" id="pwrLev" class="vertical-lever" min="0" max="5" value="0">
            </div>
            <div id="pwrVal" class="lever-val" style="color:var(--led-green)">P0</div>
            <div style="width:100%; margin-top:10px;">
                <button class="rect-btn" style="background:#f1c40f; color:black" onclick="handleDoor(true)">문 열림</button>
                <button class="rect-btn" style="background:#7f8c8d" onclick="handleDoor(false)">문 닫힘</button>
            </div>
        </section>

        <section class="center-display">
            <div class="gauge-panel">
                <div class="speed-digit" id="speedDisp">0</div>
                <div style="color:#666; font-size:0.7rem">km/h</div>
            </div>

            <div class="train-occupancy-board" id="occupancyBoard"></div>

            <div class="tcms-panel">
                <div class="tcms-screen" id="tcmsMonitor">
                    <div id="doorStatus" style="color:var(--led-red)">● 출입문: 열림</div>
                    <div id="hvacStatus">● 냉난방: 정지</div>
                    <div id="lightStatus">● 객실조명: 소등</div>
                    <div id="arriveLockStatus" style="color:var(--warning-orange)">● 상태: 출발대기</div>
                </div>
                <div class="tcms-btn-grid">
                    <button class="tcms-btn" id="btnHvac" onclick="toggleTcms('hvac')">냉난방</button>
                    <button class="tcms-btn" id="btnLight" onclick="toggleTcms('light')">객실조명</button>
                </div>
            </div>
        </section>

        <section class="lever-area">
            <div style="font-weight:bold; color:var(--led-red); font-size:0.8rem;">제동변환기(B)</div>
            <div class="lever-container">
                <input type="range" id="brkLev" class="vertical-lever" min="0" max="8" value="8">
            </div>
            <div id="brkVal" class="lever-val" style="color:var(--led-red)">B8</div>
            <div style="width:100%; margin-top:10px;">
                <button class="rect-btn" style="background:#c0392b" id="btnArrive" onclick="pressArrive()">도착 정지</button>
                <button class="rect-btn" style="background:radial-gradient(#ff4d4d, #990000); padding: 5px 0;" onclick="emergencyBrake()">긴급제동</button>
            </div>
        </section>
    </main>

    <footer class="bottom-panel">
        <div class="radio-box">
            <div class="ptt-btn" onmousedown="radioOn()" onmouseup="radioOff()" ontouchstart="radioOn()" ontouchend="radioOff()"></div>
            <div style="font-size:0.7rem"><strong>TRS 무전기</strong><br><span id="radioStatus">대기...</span></div>
        </div>
        <div class="ann-grid">
            <button class="ann-btn" onclick="playAnn(1)">역 안내</button>
            <button class="ann-btn" onclick="playAnn(2)">발 빠짐</button>
            <button class="ann-btn" id="btnTerm" onclick="playAnn(3)" disabled>종점방송</button>
        </div>
    </footer>
</div>

<script>
    const stations = ["서울역", "공덕", "홍대입구", "디지털미디어시티", "마곡나루", "김포공항", "계양", "검암", "청라국제도시", "영종", "운서", "공항화물청사", "인천공항1터미널", "인천공항2터미널"];
    let currentRoute = [];
    let sIdx = 0;
    let speed = 0;
    let isDoorOpen = true;
    let isEB = false;
    let hvac = false;
    let light = false;
    let hasArrivedAtCurrentStation = true; 
    let occupancyLevels = [20, 45, 80, 55, 30];

    function initRoute() {
        const dir = document.getElementById('routeSelect').value;
        currentRoute = dir === 'toIncheon' ? [...stations] : [...stations].reverse();
        sIdx = 0; speed = 0; isEB = false; hasArrivedAtCurrentStation = true; 
        createOccupancyBoard();
        updateUI();
    }

    function createOccupancyBoard() {
        const board = document.getElementById('occupancyBoard');
        board.innerHTML = '';
        for(let i=1; i<=5; i++) {
            const level = occupancyLevels[i-1];
            const color = level > 70 ? 'var(--led-red)' : (level > 40 ? 'var(--warning-orange)' : 'var(--led-green)');
            const car = document.createElement('div');
            car.className = 'car-unit';
            car.innerHTML = `<div class="car-label">${i}</div><div class="occupancy-bar-bg"><div style="width:100%; height:${level}%; position:absolute; bottom:0; background:${color}; transition:0.5s;"></div></div><div id="door-ind-${i}" class="car-door-indicator ${isDoorOpen ? 'open' : ''}"></div>`;
            board.appendChild(car);
        }
    }

    setInterval(() => {
        document.getElementById('clock').innerText = new Date().toLocaleTimeString('ko-KR', {hour12:false});
        const pwr = parseInt(document.getElementById('pwrLev').value);
        const brk = parseInt(document.getElementById('brkLev').value);
        
        document.getElementById('pwrVal').innerText = "P" + pwr;
        document.getElementById('brkVal').innerText = (brk === 0) ? "RUN" : "B" + brk;

        if (isEB) speed -= 5.0;
        else {
            if (pwr > 0 && brk === 0 && !isDoorOpen) {
                speed += (pwr * 0.3);
                if (hasArrivedAtCurrentStation) {
                    hasArrivedAtCurrentStation = false;
                    document.getElementById('arriveLockStatus').innerText = "● 상태: 주행 중";
                    document.getElementById('arriveLockStatus').style.color = "white";
                    updateUI();
                }
            } 
            if (brk > 0) speed -= (brk * 0.5); 
            else speed -= 0.1;
        }

        if (speed < 0) speed = 0;
        if (speed > 110) speed = 110;
        document.getElementById('speedDisp').innerText = Math.floor(speed);
        
        const btnArrive = document.getElementById('btnArrive');
        btnArrive.disabled = !(Math.floor(speed) === 0 && !isEB && !hasArrivedAtCurrentStation);
    }, 100);

    function handleDoor(open) {
        if (speed > 0) { speak("주행 중 문을 열 수 없습니다."); return; }
        isDoorOpen = open;
        document.getElementById('doorStatus').innerText = open ? "● 출입문: 열림" : "● 출입문: 닫힘";
        document.getElementById('doorStatus').style.color = open ? "var(--led-red)" : "var(--led-green)";
        for(let i=1; i<=5; i++) {
            const ind = document.getElementById(`door-ind-${i}`);
            if(open) ind.classList.add('open'); else ind.classList.remove('open');
        }
        speak(open ? "문이 열립니다. 주의하시기 바랍니다." : "문이 닫힙니다. 뒤로 물러나 주시기 바랍니다.");
    }

    function pressArrive() {
        if (hasArrivedAtCurrentStation) return;
        if (sIdx < currentRoute.length - 2) {
            sIdx++;
            hasArrivedAtCurrentStation = true; 
            updateUI();
            occupancyLevels = occupancyLevels.map(l => Math.max(10, Math.min(95, l + (Math.random()*40 - 20))));
            createOccupancyBoard();
            document.getElementById('arriveLockStatus').innerText = "● 상태: 도착 완료";
            document.getElementById('arriveLockStatus').style.color = "var(--led-green)";
            speak("잠시 후 도착합니다.");
        }
    }

    function emergencyBrake() {
        isEB = true;
        document.getElementById('brkLev').value = 8;
        document.getElementById('pwrLev').value = 0;
        speak("긴급 제동이 체결되었습니다!");
    }

    function updateUI() {
        const next = currentRoute[sIdx + 1] || "종착역";
        document.getElementById('nextStation').innerText = next;
        document.getElementById('btnTerm').disabled = (sIdx + 1 !== currentRoute.length - 1);
    }

    function toggleTcms(type) {
        if(type === 'hvac') {
            hvac = !hvac;
            document.getElementById('hvacStatus').innerText = hvac ? "● 냉난방: 가동 중" : "● 냉난방: 정지";
            document.getElementById('btnHvac').classList.toggle('active');
        } else if(type === 'light') {
            light = !light;
            document.getElementById('lightStatus').innerText = light ? "● 객실조명: 점등" : "● 객실조명: 소등";
            document.getElementById('btnLight').classList.toggle('active');
        }
    }

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function makeStatic() {
        const node = audioCtx.createBufferSource();
        const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.2, audioCtx.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < data.length; i++) data[i] = Math.random() * 2 - 1;
        node.buffer = buffer; node.connect(audioCtx.destination); node.start();
    }
    function radioOn() { makeStatic(); document.getElementById('radioStatus').innerText = "송신 중..."; }
    function radioOff() {
        document.getElementById('radioStatus').innerText = "수신 중...";
        setTimeout(() => { makeStatic(); speak("관제실입니다. 말씀하세요."); }, 400);
    }

    function speak(text) {
        window.speechSynthesis.cancel();
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'ko-KR';
        msg.rate = 1.0;
        window.speechSynthesis.speak(msg);
    }

    function playAnn(type) {
        const next = currentRoute[sIdx + 1];
        if (type === 1) {
            speak(`이번 역은 ${next}, ${next} 역입니다. 내리실 문은 왼쪽입니다.`);
        } else if (type === 2) {
            speak(`승강장과 열차 사이가 넓습니다. 내리실 때 발 빠짐에 주의하시기 바랍니다.`);
        } else if (type === 3) {
            speak(`우리 열차는 이 역이 마지막 역인 ${next} 역입니다. 오늘도 공항철도를 이용해 주셔서 감사합니다. 안녕히 가십시오.`);
        }
    }

    window.onload = initRoute;
</script>
</body>
</html>
